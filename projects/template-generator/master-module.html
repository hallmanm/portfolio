<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="referrer" content="no-referrer-when-downgrade" />
    <link href="https://www.contentstack.com/sdks/contentstack-ui-extensions/dist/latest/ui-extension-sdk.css" rel="stylesheet" type="text/css" media="all" />
    <script src="https://www.contentstack.com/sdks/contentstack-ui-extensions/dist/latest/ui-extension-sdk.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <style>
      .hidden-sm-hidden,
      .md .hidden-md-hidden,
      .lg .hidden-md-hidden,
      .lg .preview .hidden-lg-hidden {
        display: none;
      }
      .hidden-sm-show,
      .md .hidden-md-show,
      .lg .hidden-md-show,
      .lg .preview .hidden-lg-show {
        display: block;
      }
      .span-sm-12,
      .md .span-md-12,
      .lg .span-md-12,
      .lg .preview .span-lg-12 {
        width: 100%;
      }
      .span-sm-11,
      .md .span-md-11,
      .lg .span-md-11,
      .lg .preview .span-lg-11 {
        width: 91.66666667%;
      }
      .span-sm-10,
      .md .span-md-10,
      .lg .span-md-10,
      .lg .preview .span-lg-10 {
        width: 83.33333333%;
      }
      .span-sm-9,
      .md .span-md-9,
      .lg .span-md-9,
      .lg .preview .span-lg-9 {
        width: 75%;
      }
      .span-sm-8,
      .md .span-md-8,
      .lg .span-md-8,
      .lg .preview .span-lg-8 {
        width: 66.66666667%;
      }
      .span-sm-7,
      .md .span-md-7,
      .lg .span-md-7,
      .lg .preview .span-lg-7 {
        width: 58.33333333%;
      }
      .span-sm-6,
      .md .span-md-6,
      .lg .span-md-6,
      .lg .preview .span-lg-6 {
        width: 50%;
      }
      .span-sm-5,
      .md .span-md-5,
      .lg .span-md-5,
      .lg .preview .span-lg-5 {
        width: 41.66666667%;
      }
      .span-sm-4,
      .md .span-md-4,
      .lg .span-md-4,
      .lg .preview .span-lg-4 {
        width: 33.33333333%;
      }
      .span-sm-3,
      .md .span-md-3,
      .lg .span-md-3,
      .lg .preview .span-lg-3 {
        width: 25%;
      }
      .span-sm-2,
      .md .span-md-2,
      .lg .span-md-2,
      .lg .preview .span-lg-2 {
        width: 16.66666667%;
      }
      .span-sm-1,
      .md .span-md-1,
      .lg .span-md-1,
      .lg .preview .span-lg-1 {
        width: 8.33333333%;
      }
      .offset-sm-12,
      .md .offset-md-12,
      .lg .offset-md-12,
      .lg .preview .offset-lg-12 {
        margin-left: 100%;
      }
      .offset-sm-11,
      .md .offset-md-11,
      .lg .offset-md-11,
      .lg .preview .offset-lg-11 {
        margin-left: 91.66666667%;
      }
      .offset-sm-10,
      .md .offset-md-10,
      .lg .offset-md-10,
      .lg .preview .offset-lg-10 {
        margin-left: 83.33333333%;
      }
      .offset-sm-9,
      .md .offset-md-9,
      .lg .offset-md-9,
      .lg .preview .offset-lg-9 {
        margin-left: 75%;
      }
      .offset-sm-8,
      .md .offset-md-8,
      .lg .offset-md-8,
      .lg .preview .offset-lg-8 {
        margin-left: 66.66666667%;
      }
      .offset-sm-7,
      .md .offset-md-7,
      .lg .offset-md-7,
      .lg .preview .offset-lg-7 {
        margin-left: 58.33333333%;
      }
      .offset-sm-6,
      .md .offset-md-6,
      .lg .offset-md-6,
      .lg .preview .offset-lg-6 {
        margin-left: 50%;
      }
      .offset-sm-5,
      .md .offset-md-5,
      .lg .offset-md-5,
      .lg .preview .offset-lg-5 {
        margin-left: 41.66666667%;
      }
      .offset-sm-4,
      .md .offset-md-4,
      .lg .offset-md-4,
      .lg .preview .offset-lg-4 {
        margin-left: 33.33333333%;
      }
      .offset-sm-3,
      .md .offset-md-3,
      .lg .offset-md-3,
      .lg .preview .offset-lg-3 {
        margin-left: 25%;
      }
      .offset-sm-2,
      .md .offset-md-2,
      .lg .offset-md-2,
      .lg .preview .offset-lg-2 {
        margin-left: 16.66666667%;
      }
      .offset-sm-1,
      .md .offset-md-1,
      .lg .offset-md-1,
      .lg .preview .offset-lg-1 {
        margin-left: 8.33333333%;
      }
      .offset-sm-0,
      .md .offset-md-0,
      .lg .offset-md-0,
      .lg .preview .offset-lg-0 {
        margin-left: 0%;
      }
      .split-sm-push,
      .md .split-md-push,
      .lg .split-md-push,
      .lg .preview .split-lg-push {
        left: 4.165%;
      }
      .split-sm-pull,
      .md .split-md-pull,
      .lg .split-md-pull,
      .lg .preview .split-lg-pull {
        left: -4.165%;
      }
      .split-sm-none,
      .md .split-md-none,
      .lg .split-md-none,
      .lg .preview .split-lg-none {
        left: 0;
      }
      .row:after {
        clear: both;
      }
      .row {
        float: left;
        position: relative;
        min-height: 100px;
        width: 100%;
      }
      .row [class*='col-'],
      .block,
      .block-wrap {
        float: left;
        position: relative;
        height: 100px;
      }
      .grid .row div {
        float: left;
        width: 8.33333333%;
        min-height: 100px;
        background-color: rgba(232, 240, 242, 0.2);
      }
      .grid div {
        height: 100%;
      }
      .tabs,
      .filter_wrap {
        z-index: 2;
        position: absolute;
        top: 0;
      }
      .filter_wrap {
        right: 0;
      }
      .lg .tabs .lg-break,
      .md .tabs .md-break,
      .sm .tabs .sm-break {
        background-color: #63747f;
      }
      .md .preview {
        max-width: 768px;
      }
      .sm .preview {
        max-width: 375px;
      }
      .preview {
        margin: 0 auto;
        overflow: hidden;
      }
      .preview,
      .grid {
        position: relative;
      }
      .options {
        position: relative;
        height: 100%;
      }
      .preview,
      .overlay {
        padding-top: 200px;
        padding-bottom: 200px;
      }
      .grid .row div:nth-child(odd),
      .overlay #content .row:nth-child(odd) {
        background-color: rgba(232, 240, 242, 0.6);
      }
      .grid,
      .overlay,
      .options {
        width: 100%;
        padding-left: 30px;
        padding-right: 30px;
      }
      .overlay,
      .options {
        position: absolute;
        left: 0;
        top: 0;
      }
      .overlay {
        z-index: 1;
      }
      .options {
        display: none;
        z-index: 3;
        color: #fff;
        background-color: rgba(0, 0, 0, 0.6);
      }
      .options.show-opts {
        display: block;
      }
      .overlay > .row:nth-child(1)::before,
      .overlay > .row:nth-child(2)::before,
      .overlay > .row:nth-child(3)::before {
        z-index: 1;
        position: absolute;
        top: 45%;
        width: 100%;
        height: 100%;
        text-align: center;
        text-transform: uppercase;
        font-weight: bold;
        color: #63747f;
      }
      .overlay > .row:nth-child(1)::before {
        content: 'above';
      }
      .overlay > .row:nth-child(2)::before {
        content: 'background';
      }
      .overlay > .row:nth-child(3)::before {
        content: 'below';
      }
      #content {
        border: 2px solid #63747f;
        border-left: 0;
        border-right: 0;
      }
      .block {
        z-index: 1;
        background-color: #fff;
        background-color: rgba(255, 255, 255, 0.7);
        border: 3px solid #e8f0f2;
        box-shadow: 3px 3px 5px -2px rgb(0, 0, 0, 0.5);
        /*overflow: hidden;*/
      }
      .block:hover {
        z-index: 2;
      }
      .block .opts,
      .block .remove,
      .options .remove {
        z-index: 1;
        position: absolute;
        width: 15px;
        text-align: center;
        cursor: pointer;
      }
      .block .remove,
      .options .remove {
        left: 0;
      }
      .block .opts {
        right: 0;
      }
      .block .opts,
      .block .remove {
        display: none;
      }
      .block:hover .opts,
      .block:hover .remove {
        display: block;
      }
      .block:hover .opts {
        right: -15px;
      }
      .block:hover .remove {
        left: -15px;
      }
      /*.sm .span-sm-1.block .opts,
      .sm .span-sm-1.block .remove {
        display: none;
      }
      .sm .span-sm-1.block:hover .opts,
      .sm .span-sm-1.block:hover .remove {
        display: block;
      }
      .sm .span-sm-1.block:hover .opts {
        right: -15px;
      }
      .sm .span-sm-1.block:hover .remove {
        left: -15px;
      }*/
      .block .num {
        position: absolute;
        bottom: 0;
        right: 0;
        font-size: 16px;
        text-align: center;
      }
      .ctrl-block,
      .ctrl-row {
        position: absolute;
        display: inline-block;
        width: 30px;
        color: #fff;
        font-weight: bold;
        text-align: center;
      }
      .ctrl-row {
        top: 15px;
        right: -30px;
      }
      .ctrl-block {
        left: -30px;
      }
      .ctrl-block div,
      .ctrl-row div {
        cursor: pointer;
      }
      .ctrl-row div {
        margin: 2px 0;
      }
      .hide-removal .ctrl-row .remove {
        opacity: 0;
        pointer-events: none;
      }
      .opts,
      .add,
      .remove {
        color: #63747f;
        cursor: pointer;
        background-color: #e8f0f2;
      }
      .opts:hover,
      .add:hover,
      .remove:hover {
        color: #fff;
      }
      .opts:hover {
        background-color: #63747f;
      }
      .add:hover {
        background-color: #25c2a3;
      }
      .remove:hover {
        background-color: #e44952;
      }
      @media (max-width: 530px) {
        .block .remove {
          bottom: 0;
        }
      }
      .options .close {
        position: absolute;
        right: 10px;
        top: 10px;
      }
      .hidden-error .hidden-feedback,
      .hidden-error .hidden-feedback,
      .hidden-error .hidden-feedback,
      .offset-error-lg .offset-feedback-lg,
      .offset-error-md .offset-feedback-md,
      .offset-error-sm .offset-feedback-sm,
      .span-error-lg .span-feedback-lg,
      .span-error-md .span-feedback-md,
      .span-error-sm .span-feedback-sm,
      .animation-error-lg .animation-feedback-lg,
      .animation-error-md .animation-feedback-md,
      .animation-error-sm .animation-feedback-sm,
      .animate-error-lg .animate-feedback-lg,
      .animate-error-md .animate-feedback-md,
      .animate-error-sm .animate-feedback-sm {
        outline: 2px solid #e44952;
      }
      .form {
        position: relative;
        top: 2%;
        width: 98%;
        padding: 25px 0;
        background-color: #63747f;
      }
      .form,
      table {
        text-align: center;
        margin: 0 auto;
        color: #fff;
      }
      table {
        padding: 25px 15px 0 15px;
      }
      .form .cs-text-box,
      .form label {
        font-size: 15px;
        padding: 6px 2px;
        height: auto;
      }
      .module-top,
      .module-bottom {
        z-index: 1;
        position: absolute;
        width: 100%;
        width: calc(100% - 60px);
        margin: 0 30px;
        height: 200px;
        border: 2px solid #e8f0f2;
      }
      .module-top {
        top: 0px;
        margin-top: 100px;
        border-top: none;
        background-image: linear-gradient(rgba(255, 255, 255, 0.4), rgba(232, 240, 242, 0.8));
      }
      .module-bottom {
        bottom: 0px;
        margin-bottom: 100px;
        border-bottom: none;
        background-image: linear-gradient(rgba(232, 240, 242, 0.8), rgba(255, 255, 255, 0.4));
      }
      .sm-top-margin,
      .md-top-margin,
      .lg-top-margin,
      .sm-bottom-margin,
      .md-bottom-margin,
      .lg-bottom-margin {
        display: none;
      }
      .sm .sm-top-margin,
      .md .md-top-margin,
      .lg .lg-top-margin,
      .sm .sm-bottom-margin,
      .md .md-bottom-margin,
      .lg .lg-bottom-margin {
        display: inline-block;
      }
      .sm .sm-has-top-content .module-top,
      .md .md-has-top-content .module-top,
      .lg .lg-has-top-content .module-top {
        margin-top: 0;
      }
      .sm .sm-has-bottom-content .module-bottom,
      .md .md-has-bottom-content .module-bottom,
      .lg .lg-has-bottom-content .module-bottom {
        margin-bottom: 0;
      }
      .margin-top,
      .margin-bottom {
        z-index: 2;
        position: absolute;
        width: 100%;
        text-align: center;
      }
      .margin-top {
        top: 150px;
      }
      .margin-bottom {
        bottom: 150px;
      }
      /*.md .ctrl-block,
      .md .ctrl-row,
      .md .block .remove,
      .md .margin-top,
      .md .margin-bottom,
      .sm .ctrl-block,
      .sm .ctrl-row,
      .sm .block .remove,
      .sm .margin-top,
      .sm .margin-bottom{
        display: none;
      }*/
      .view {
        position: absolute;
        top: 40%;
        width: 100%;
      }
      .anchor-sm-top .view,
      .md .anchor-md-top .view,
      .lg .anchor-md-top .view,
      .lg .preview .anchor-lg-top .view,
      .anchor-sm-tl .view,
      .md .anchor-md-tl .view,
      .lg .anchor-md-tl .view,
      .lg .preview .anchor-lg-tl .view,
      .anchor-sm-tr .view,
      .md .anchor-md-tr .view,
      .lg .anchor-md-tr .view,
      .lg .preview .anchor-lg-tr .view {
        top: 0;
      }
      /*.sm .span-sm-1.anchor-sm-top .view,
      .sm .span-sm-1.anchor-sm-top .view{
        top:25px;
      }*/
      .anchor-sm-bottom .view,
      .md .anchor-md-bottom .view,
      .lg .anchor-md-bottom .view,
      .lg .preview .anchor-lg-bottom .view,
      .anchor-sm-bl .view,
      .md .anchor-md-bl .view,
      .lg .anchor-md-bl .view,
      .lg .preview .anchor-lg-bl .view,
      .anchor-sm-br .view,
      .md .anchor-md-br .view,
      .lg .anchor-md-br .view,
      .lg .preview .anchor-lg-br .view {
        top: calc(100% - 20px);
      }
      /*.sm .span-sm-1.anchor-sm-bottom .view,
      .sm .span-sm-2.anchor-sm-bottom .view{
        top: calc(100% - 42px);
      }*/
      .view-wrap {
        position: relative;
        width: 20px;
        height: 20px;
        margin: 0 auto;
        border-width: 0;
        border-style: solid;
        border-color: #63747f;
      }
      .anchor-sm-left .view-wrap,
      .md .anchor-md-left .view-wrap,
      .lg .anchor-md-left .view-wrap,
      .lg .preview .anchor-lg-left .view-wrap,
      .anchor-sm-tl .view-wrap,
      .md .anchor-md-tl .view-wrap,
      .lg .anchor-md-tl .view-wrap,
      .lg .preview .anchor-lg-tl .view-wrap,
      .anchor-sm-bl .view-wrap,
      .md .anchor-md-bl .view-wrap,
      .lg .anchor-md-bl .view-wrap,
      .lg .preview .anchor-lg-bl .view-wrap {
        margin-left: 0;
      }
      .anchor-sm-right .view-wrap,
      .md .anchor-md-right .view-wrap,
      .lg .anchor-md-right .view-wrap,
      .lg .preview .anchor-lg-right .view-wrap,
      .anchor-sm-tr .view-wrap,
      .md .anchor-md-tr .view-wrap,
      .lg .anchor-md-tr .view-wrap,
      .lg .preview .anchor-lg-tr .view-wrap,
      .anchor-sm-br .view-wrap,
      .md .anchor-md-br .view-wrap,
      .lg .anchor-md-br .view-wrap,
      .lg .preview .anchor-lg-br .view-wrap {
        margin-right: 0;
      }
      .anchor-sm-center .view,
      .anchor-sm-left .view,
      .anchor-sm-right .view,
      .md .anchor-md-center .view,
      .md .anchor-md-left .view,
      .md .anchor-md-right .view,
      .lg .anchor-md-center .view,
      .lg .anchor-md-left .view,
      .lg .anchor-md-right .view,
      .lg .preview .anchor-lg-center .view,
      .lg .preview .anchor-lg-left .view,
      .lg .preview .anchor-lg-right .view {
        top: 40%;
      }
      .anchor-sm-center .view-wrap,
      .anchor-sm-top .view-wrap,
      .anchor-sm-bottom .view-wrap,
      .md .anchor-md-center .view-wrap,
      .md .anchor-md-top .view-wrap,
      .md .anchor-md-bottom .view-wrap,
      .lg .anchor-md-center .view-wrap,
      .lg .anchor-md-top .view-wrap,
      .lg .anchor-md-bottom .view-wrap,
      .lg .preview .anchor-lg-center .view-wrap,
      .lg .preview .anchor-lg-top .view-wrap,
      .lg .preview .anchor-lg-bottom .view-wrap {
        margin: 0 auto;
      }
      .border-sm-top .view-wrap,
      .md .border-md-top .view-wrap,
      .lg .border-md-top .view-wrap,
      .lg .preview .border-lg-top .view-wrap {
        border-top-width: 1px;
        border-bottom-width: 0;
        border-left-width: 0;
        border-right-width: 0;
      }
      .border-sm-bottom .view-wrap,
      .md .border-md-bottom .view-wrap,
      .lg .border-md-bottom .view-wrap,
      .lg .preview .border-lg-bottom .view-wrap {
        border-top-width: 0;
        border-bottom-width: 1px;
        border-left-width: 0;
        border-right-width: 0;
      }
      .border-sm-left .view-wrap,
      .md .border-md-left .view-wrap,
      .lg .border-md-left .view-wrap,
      .lg .preview .border-lg-left .view-wrap {
        border-top-width: 0;
        border-bottom-width: 0;
        border-left-width: 1px;
        border-right-width: 0;
      }
      .border-sm-right .view-wrap,
      .md .border-md-right .view-wrap,
      .lg .border-md-right .view-wrap,
      .lg .preview .border-lg-right .view-wrap {
        border-top-width: 0;
        border-bottom-width: 0;
        border-left-width: 0;
        border-right-width: 1px;
      }
      .border-sm-none .view-wrap,
      .md .border-md-none .view-wrap,
      .lg .border-md-none .view-wrap,
      .lg .preview .border-lg-none .view-wrap {
        border-top-width: 0;
        border-bottom-width: 0;
        border-left-width: 0;
        border-right-width: 0;
      }
      .background {
        z-index: -1;
        position: absolute;
        /*left:0;
        top:0;*/
        width: 100%;
        height: 100%;
        background-color: #e8f0f2;
      }
      .text {
        position: absolute;
        padding: 3px;
        font-size: 20px;
        line-height: 3px;
        color: #63747f;
        text-align: center;
      }
      .background,
      .text {
        animation-duration: 3s;
        animation-iteration-count: infinite;
      }
      .justify-sm-left .text,
      .md .justify-md-left .text,
      .lg .justify-md-left .text,
      .lg .preview .justify-lg-left .text {
        text-align: left;
      }
      .justify-sm-right .text,
      .md .justify-md-right .text,
      .lg .justify-md-right .text,
      .lg .preview .justify-lg-right .text {
        text-align: right;
      }
      .justify-sm-center .text,
      .md .justify-md-center .text,
      .lg .justify-md-center .text,
      .lg .preview .justify-lg-center .text {
        text-align: center;
      }
      @keyframes left {
        0% {
          left: -100%;
          opacity: 0;
        }
        70% {
          left: 0;
          opacity: 1;
        }
        100% {
          left: 0;
          opacity: 1;
        }
      }
      @keyframes right {
        0% {
          right: -100%;
          opacity: 0;
        }
        70% {
          right: 0;
          opacity: 1;
        }
        100% {
          right: 0;
          opacity: 1;
        }
      }
      @keyframes top {
        0% {
          top: -100%;
          opacity: 0;
        }
        70% {
          top: 0;
          opacity: 1;
        }
        100% {
          top: 0;
          opacity: 1;
        }
      }
      @keyframes bottom {
        0% {
          bottom: -100%;
          top: unset;
          opacity: 0;
        }
        70% {
          bottom: 0;
          top: unset;
          opacity: 1;
        }
        100% {
          bottom: 0;
          top: unset;
          opacity: 1;
        }
      }
      .animation-sm-top.animate-sm-text .text,
      .animation-sm-top.animate-sm-background .background,
      .animation-sm-top.animate-sm-both .text,
      .animation-sm-top.animate-sm-both .background,
      .md .animation-md-top.animate-md-text .text,
      .md .animation-md-top.animate-md-background .background,
      .md .animation-md-top.animate-md-both .text,
      .md .animation-md-top.animate-md-both .background,
      .lg .animation-md-top.animate-md-text .text,
      .lg .animation-md-top.animate-md-background .background,
      .lg .animation-md-top.animate-md-both .text,
      .lg .animation-md-top.animate-md-both .background,
      .lg .preview .animation-lg-top.animate-lg-text .text,
      .lg .preview .animation-lg-top.animate-lg-background .background,
      .lg .preview .animation-lg-top.animate-lg-both .text,
      .lg .preview .animation-lg-top.animate-lg-both .background {
        animation-name: top;
      }
      .animation-sm-right.animate-sm-text .text,
      .animation-sm-right.animate-sm-background .background,
      .animation-sm-right.animate-sm-both .text,
      .animation-sm-right.animate-sm-both .background,
      .md .animation-md-right.animate-md-text .text,
      .md .animation-md-right.animate-md-background .background,
      .md .animation-md-right.animate-md-both .text,
      .md .animation-md-right.animate-md-both .background,
      .lg .animation-md-right.animate-md-text .text,
      .lg .animation-md-right.animate-md-background .background,
      .lg .animation-md-right.animate-md-both .text,
      .lg .animation-md-right.animate-md-both .background,
      .lg .preview .animation-lg-right.animate-lg-text .text,
      .lg .preview .animation-lg-right.animate-lg-background .background,
      .lg .preview .animation-lg-right.animate-lg-both .text,
      .lg .preview .animation-lg-right.animate-lg-both .background {
        animation-name: right;
      }
      .animation-sm-bottom.animate-sm-text .text,
      .animation-sm-bottom.animate-sm-background .background,
      .animation-sm-bottom.animate-sm-both .text,
      .animation-sm-bottom.animate-sm-both .background,
      .md .animation-md-bottom.animate-md-text .text,
      .md .animation-md-bottom.animate-md-background .background,
      .md .animation-md-bottom.animate-md-both .text,
      .md .animation-md-bottom.animate-md-both .background,
      .lg .animation-md-bottom.animate-md-text .text,
      .lg .animation-md-bottom.animate-md-background .background,
      .lg .animation-md-bottom.animate-md-both .text,
      .lg .animation-md-bottom.animate-md-both .background,
      .lg .preview .animation-lg-bottom.animate-lg-text .text,
      .lg .preview .animation-lg-bottom.animate-lg-background .background,
      .lg .preview .animation-lg-bottom.animate-lg-both .text,
      .lg .preview .animation-lg-bottom.animate-lg-both .background {
        animation-name: bottom;
      }
      .animation-sm-left.animate-sm-text .text,
      .animation-sm-left.animate-sm-background .background,
      .animation-sm-left.animate-sm-both .text,
      .animation-sm-left.animate-sm-both .background,
      .md .animation-md-left.animate-md-text .text,
      .md .animation-md-left.animate-md-background .background,
      .md .animation-md-left.animate-md-both .text,
      .md .animation-md-left.animate-md-both .background,
      .lg .animation-md-left.animate-md-text .text,
      .lg .animation-md-left.animate-md-background .background,
      .lg .animation-md-left.animate-md-both .text,
      .lg .animation-md-left.animate-md-both .background,
      .lg .preview .animation-lg-left.animate-lg-text .text,
      .lg .preview .animation-lg-left.animate-lg-background .background,
      .lg .preview .animation-lg-left.animate-lg-both .text,
      .lg .preview .animation-lg-left.animate-lg-both .background {
        animation-name: left;
      }
      .md .animation-md-top.animate-md-text .background,
      .md .animation-md-top.animate-md-background .text,
      .md .animation-md-right.animate-md-text .background,
      .md .animation-md-right.animate-md-background .text,
      .md .animation-md-bottom.animate-md-text .background,
      .md .animation-md-bottom.animate-md-background .text,
      .md .animation-md-left.animate-md-text .background,
      .md .animation-md-left.animate-md-background .text,
      .lg .animation-md-top.animate-md-text .background,
      .lg .animation-md-top.animate-md-background .text,
      .lg .animation-md-right.animate-md-text .background,
      .lg .animation-md-right.animate-md-background .text,
      .lg .animation-md-bottom.animate-md-text .background,
      .lg .animation-md-bottom.animate-md-background .text,
      .lg .animation-md-left.animate-md-text .background,
      .lg .animation-md-left.animate-md-background .text,
      .lg .animation-md-none .text,
      .lg .animation-md-none .background,
      .lg .preview .animation-lg-top.animate-lg-text .background,
      .lg .preview .animation-lg-top.animate-lg-background .text,
      .lg .preview .animation-lg-right.animate-lg-text .background,
      .lg .preview .animation-lg-right.animate-lg-background .text,
      .lg .preview .animation-lg-bottom.animate-lg-text .background,
      .lg .preview .animation-lg-bottom.animate-lg-background .text,
      .lg .preview .animation-lg-left.animate-lg-text .background,
      .lg .preview .animation-lg-left.animate-lg-background .text {
        animation-name: none;
      }
      .md .animation-md-none .text,
      .md .animation-md-none .background,
      .lg .animation-lg-none .text,
      .lg .animation-lg-none .background {
        animation-name: none !important;
      }
      .options[class*='error'] .apply-btn {
        pointer-events: none;
        background-color: #d1dfe2;
        color: #748590;
      }

      .btn {
        margin: 0 2px;
      }
    </style>
  </head>
  <body id="aeo_module_master" class="aeo-module-master sm">
    <div class="tabs" style="display: flex">
      <div style="display: flex; margin: 20px 8px 0 0">
        <button onclick="updateBreakpoint('sm')" class="sm-break btn cs-border-btn btn-large">Small</button>
        <button onclick="updateBreakpoint('md')" class="md-break btn cs-border-btn btn-large">Medium</button>
        <button onclick="updateBreakpoint('lg')" class="lg-break btn cs-border-btn btn-large">Large</button>
      </div>

      <div class="w-45">
        <label for="filters" style="display: block">Row Anchor</label
        ><select id="row-anchors" class="cs-text-box w-100" style="text-transform: capitalize" name="filters" onchange="updateRowAnchor(this.value)"></select>
      </div>
    </div>
    <!-- <div class="w-20" style="display: inline-block; position: absolute; top: 0; left: 50%; z-index: 10; transform: translate(-50%, 0)">
      <label for="filters" style="display: block">Row Anchor</label
      ><select id="row-anchors" class="cs-text-box w-100" style="text-transform: capitalize" name="filters" onchange="updateRowAnchor(this.value)"></select>
    </div> -->
    <div id="filter_wrap" class="filter_wrap"></div>
    <div id="options" class="options">
      <div class="form">
        <div class="close btn pub-release cs-btn-warning btn-large" onclick="closeOptions()">&#215;</div>
        <table id="opts"></table>
      </div>
    </div>
    <div id="height">
      <div id="preview" class="preview">
        <div id="module_top" class="module-top"></div>
        <div class="margin-top">
          <label for="top-margin">Top Margin</label>
          <input id="sm_top_margin" class="cs-text-box sm-top-margin" type="number" min="0" value="0" name="top-margin" onchange="updateMargin('sm','top',parseInt(this.value))" />
          <input id="md_top_margin" class="cs-text-box md-top-margin" type="number" min="0" value="0" name="top-margin" onchange="updateMargin('md','top',parseInt(this.value))" />
          <input id="lg_top_margin" class="cs-text-box lg-top-margin" type="number" min="0" value="0" name="top-margin" onchange="updateMargin('lg','top',parseInt(this.value))" />
        </div>
        <div id="grid" class="grid">
          <div class="row"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div>
        </div>
        <div class="margin-bottom">
          <label for="bottom-margin">Bottom Margin</label>
          <input id="sm_bottom_margin" class="cs-text-box sm-bottom-margin" type="number" min="0" value="0" name="bottom-margin" onchange="updateMargin('sm','bottom',parseInt(this.value))" />
          <input id="md_bottom_margin" class="cs-text-box md-bottom-margin" type="number" min="0" value="0" name="bottom-margin" onchange="updateMargin('md','bottom',parseInt(this.value))" />
          <input id="lg_bottom_margin" class="cs-text-box lg-bottom-margin" type="number" min="0" value="0" name="bottom-margin" onchange="updateMargin('lg','bottom',parseInt(this.value))" />
        </div>
        <div id="module_bottom" class="module-bottom"></div>
        <div id="overlay" class="overlay">
          <div class="row" id="row_above">
            <div class="ctrl-block">
              <div class="add" onclick="addBlock('above','above')">&#43; &#9635;</div>
            </div>
          </div>
          <div class="row" id="content"></div>
          <div class="row" id="row_below">
            <div class="ctrl-block">
              <div class="add" onclick="addBlock('below','below')">&#43; &#9635;</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      var CS_data = {
        "baseURL": "https://cdn.contentstack.io/",
        "contentType": "templates_master_module",
        "templateEnv": "preview",
        "Sky Pie": {
          "apiKey": "",
          "deliveryToken": ""
        },
        "DEV": {
          "apiKey": "",
          "deliveryToken": ""
        },
        "SIT": {
          "apiKey": "",
          "deliveryToken": ""
        },
        "SIT2": {
          "apiKey": "",
          "deliveryToken": ""
        },
        "PERF": {
          "apiKey": "",
          "deliveryToken": ""
        },
        "PROD": {
          "apiKey": "",
          "deliveryToken": ""
        }
      };

      let extensionField;

      var body = $('body');
      var preview = $('#preview');
      var overlay = $('#overlay');
      var grid = $('#grid');
      var content = $('#content');
      var options = $('#options');
      var block_seq;
      var unique = 0;
      var processing = false;
      var updateCSDataDelay;
      var updateGridDelay;
      var updateCSDelay;
      var exclusions = ['padding', 'margin'];
      var data = {
        above: {
          row_above: {
            blocks: {}
          }
        },
        content: {},
        below: {
          row_below: {
            blocks: {}
          }
        },
        options: {
          area: '',
          row: '',
          block: ''
        },
        defaults: {
          row_anchor: 'default'
        },
        loops: {
          areas: ['above', 'content', 'below'],
          breakpoints: ['sm', 'md', 'lg'],
          options: ['hidden', 'offset', 'span', 'split', 'anchor', 'justify', 'padding', 'margin', 'border', 'animation', 'animate'],
          row_anchors: {
            default: { title: 'default', value: 'default' },
            top: { title: 'Stick to the Top', value: 'start' },
            center: { title: 'Center', value: 'center' },
            bottom: { title: 'Stick to the Bottom', value: 'end' },
            space_between: { title: 'Space Between', value: 'space-between' },
            space_evenly: { title: 'Space Evenly', value: 'space-evenly' },
            space_around: { title: 'Space Around', value: 'space-around' }
          }
        },
        output: {
          settings: {
            rowAnchor: {},
            margin: {
              sm: {
                top: 80,
                bottom: 80
              },
              md: {
                top: 80,
                bottom: 80
              },
              lg: {
                top: 80,
                bottom: 80
              }
            }
          }
        }
      };

      function init(form_data) {
        if (document.getElementById('opts').innerHTML === '') {
          fillOutData();
          createHTML();
          createTemplates(data.templates);
        }

        clearForm();

        if (form_data && form_data.layout) {
          var obj = form_data.layout;
          processing = true;

          var rows = '';
          var blocks = '';
          var row_id = '';
          var block_id = '';

          for (var area in obj) {
            rows = obj[area];

            if (area === 'content' && rows.length < 1) {
              addRow();
            } else {
              for (var i = 0; i < rows.length; i++) {
                blocks = rows[i];

                if (area === 'content') {
                  row_id = unique;

                  addRow(undefined, undefined, row_id);
                } else {
                  row_id = area;
                }

                for (var x = 0; x < blocks.length; x++) {
                  block = blocks[x];
                  block_id = unique;

                  addBlock(area, row_id, block_id, block);
                  updateBlock(area, row_id, block_id);
                }
              }
            }
          }

          for (var z = 0; z < data.loops.breakpoints.length; z++) {
            var size = data.loops.breakpoints[z];

            $('#' + size + '_top_margin').val(form_data.settings.margin[size].top);
            $('#' + size + '_bottom_margin').val(form_data.settings.margin[size].bottom);

            updateMargin(size, 'top', form_data.settings.margin[size].top);
            updateMargin(size, 'bottom', form_data.settings.margin[size].bottom);
          }
          createRowAnchors(form_data.settings.rowAnchor);
          processing = false;
          updateData();
        } else {
          createRowAnchors();
          addRow();
        }
      }

      function createRowAnchors(rowAnchor) {
        let rowAnchors = document.getElementById('row-anchors');

        //Resets when triggered by removing all children from row-anchors
        while (rowAnchors.firstChild) {
          rowAnchors.removeChild(rowAnchors.firstChild);
        }

        let val = rowAnchor || data.defaults.row_anchor;

        for (let row_anchor in data.loops.row_anchors) {
          let rowObj = data.loops.row_anchors[row_anchor];
          let anchorElem = document.createElement('option');

          if (val === rowObj.value) {
            anchorElem.selected = 'selected';
          }

          anchorElem.value = rowObj.value;
          anchorElem.innerHTML = rowObj.title;
          rowAnchors.appendChild(anchorElem);
        }
        updateRowAnchor(val);
      }

      function updateRowAnchor(anchor) {
        data.output.settings.rowAnchor = anchor;
        if (!processing) {
          storeData();
        }
      }

      //add data
      function fillOutData() {
        for (var i = 0; i < data.loops.breakpoints.length; i++) {
          data.options[data.loops.breakpoints[i]] = {};

          for (var x = 0; x < data.loops.options.length; x++) {
            data.options[data.loops.breakpoints[i]][data.loops.options[x]] = '';
          }
        }
      }
      //create select for templates
      function createTemplates(templates) {
        if (templates) {
          var html = '';
          var filterHtml = '';
          var template = {};
          var result = false;
          var category = '';
          var categories = [];
          var title = '';
          data.templates = templates;

          html += '<div class="w-45" style="display:inline-block; margin-left:10px;"><label for="templates" style="display:block">Templates</label><select id="templates" class="cs-text-box w-100" style="text-transform: capitalize;" name="templates" data-action="clear" onchange="updateTemplates(this)"><option class="cat-" value="">Custom</option>';

          for (var i = 0; i < templates.length; i++) {
            template = templates[i];
            title = template.title || '';
            result = title.match(/([^\-]+)\s-\s(.+)/);

            if (result && result.length === 3) {
              title = result[2] || '';
              category = result[1].replace(/\s/g, '-') || '';

              if (categories.indexOf(category) < 0) {
                categories.push(category);
              }
            } else {
              category = '';
            }

            html += '<option class="cat-' + category + '" value="' + i + '">' + title + '</option>';
          }

          html += '</select></div>';

          if (categories.length > 0) {
            filterHtml = '<div class="w-45" style="display:inline-block;"><label for="filters" style="display:block">Filter</label><select id="filters" class="cs-text-box w-100" style="text-transform: capitalize;" name="filters" onchange="filterTemplates(this)"><option value="">All</option>';

            for (var x = 0; x < categories.length; x++) {
              filterHtml += '<option value="' + categories[x] + '">' + categories[x].replace(/\-/g, ' ') + '</option>';
            }

            filterHtml += '</select></div>';
          }

          html = filterHtml + html;

          document.getElementById('filter_wrap').innerHTML = html;
        }
      }

      //filter templates
      function filterTemplates(elem) {
        if (elem.value) {
          $('#templates option[class*="cat-"]').hide();
          $('#templates option.cat-' + elem.value).show();
        } else {
          $('#templates option[class*="cat-"]').show();
        }
      }
      //create html
      function createHTML() {
        var breakpoint = '';
        var option = '';
        var html = '';

        html += '<tr><th>LOCKUP: <span id="block_seq"></span></th><th>Small</th><th>Medium</th><th>Large</th></tr>';

        for (var x = 0; x < data.loops.options.length; x++) {
          option = data.loops.options[x];

          html += '<tr>';
          for (var i = 0; i < data.loops.breakpoints.length; i++) {
            breakpoint = data.loops.breakpoints[i];
            if (i === 0) {
              html += '<td><label style="text-transform:capitalize;">' + option + '</label></td>';
            }

            switch (option) {
              case 'hidden':
                html += '<td class="' + option + '-feedback"><select id="' + option + '_' + breakpoint + '" data-type="' + option + '" class="cs-text-box w-100 bp-' + i + ' opt-' + x + '" name="' + option + '_' + breakpoint + "\" onchange=\"updateOptions(this.getAttribute('data-type'),'" + breakpoint + '\',this.value)"><option value="show">Show</option><option value="hidden">Hidden</option></select></td>';
                break;
              case 'offset':
                html += '<td class="' + option + '-feedback-' + breakpoint + '"><input id="' + option + '_' + breakpoint + '" data-type="' + option + '" class="cs-text-box w-100" type="number" min="0" max="11" value="0" name="' + option + '_' + breakpoint + "\" onchange=\"updateOptions(this.getAttribute('data-type'),'" + breakpoint + '\',parseInt(this.value))"/></td>';
                break;
              case 'span':
                html += '<td class="' + option + '-feedback-' + breakpoint + '"><input id="' + option + '_' + breakpoint + '" data-type="' + option + '" class="cs-text-box w-100" type="number" min="1" max="12" value="1" name="span_' + breakpoint + "\" onchange=\"updateOptions(this.getAttribute('data-type'),'" + breakpoint + '\',parseInt(this.value))"/></td>';
                break;
              case 'split':
                html += '<td><select id="' + option + '_' + breakpoint + '" data-type="' + option + '" class="cs-text-box w-100" name="' + option + '_' + breakpoint + "\" onchange=\"updateOptions(this.getAttribute('data-type'),'" + breakpoint + '\',this.value)"><option value="none">None</option><option value="pull">Pull</option><option value="push">Push</option></select></td>';
                break;
              case 'anchor':
                html += '<td><select id="' + option + '_' + breakpoint + '" data-type="' + option + '" class="cs-text-box w-100" name="' + option + '_' + breakpoint + "\" onchange=\"updateOptions(this.getAttribute('data-type'),'" + breakpoint + '\',this.value)"><option value="center">Center</option><option value="top">Top</option><option value="bottom">Bottom</option><option value="left">Left</option><option value="right">Right</option><option value="tl">Top Left</option><option value="tr">Top Right</option><option value="bl">Bottom Left</option><option value="br">Bottom Right</option></select></td>';
                break;
              case 'justify':
                html += '<td><select id="' + option + '_' + breakpoint + '" data-type="' + option + '" class="cs-text-box w-100" name="' + option + '_' + breakpoint + "\" onchange=\"updateOptions(this.getAttribute('data-type'),'" + breakpoint + '\',this.value)"><option value="center">Center</option><option value="left">Left</option><option value="right">Right</option></select></td>';
                break;
              case 'padding':
                html += '<td class="' + option + '_' + breakpoint + '"><input id="' + option + '_' + breakpoint + '" data-type="' + option + '" class="cs-text-box w-100" type="text" minlength="1" maxlength="23" name="' + option + '_' + breakpoint + "\" onchange=\"updateOptions(this.getAttribute('data-type'),'" + breakpoint + '\',this.value)"/></td>';
                break;
              case 'margin':
                html += '<td class="' + option + '_' + breakpoint + '"><input id="' + option + '_' + breakpoint + '" data-type="' + option + '" class="cs-text-box w-100" type="text" minlength="1" maxlength="23" name="' + option + '_' + breakpoint + "\" onchange=\"updateOptions(this.getAttribute('data-type'),'" + breakpoint + '\',this.value)"/></td>';
                break;
              case 'border':
                html += '<td><select id="' + option + '_' + breakpoint + '" data-type="' + option + '" class="cs-text-box w-100" name="' + option + '_' + breakpoint + "\" onchange=\"updateOptions(this.getAttribute('data-type'),'" + breakpoint + '\',this.value)"><option value="none">None</option><option value="top">Top</option><option value="bottom">Bottom</option><option value="left">Left</option><option value="right">Right</option></select></td>';
                break;
              case 'animation':
                html += '<td class="' + option + '-feedback-' + breakpoint + '"><select id="' + option + '_' + breakpoint + '" data-type="' + option + '" class="cs-text-box w-100" name="' + option + '_' + breakpoint + "\" onchange=\"updateOptions(this.getAttribute('data-type'),'" + breakpoint + '\',this.value)"><option value="none">None</option><option value="top">Top</option><option value="bottom">Bottom</option><option value="left">Left</option><option value="right">Right</option></select></td>';
                break;
              case 'animate':
                html += '<td class="' + option + '-feedback-' + breakpoint + '"><select id="' + option + '_' + breakpoint + '" data-type="' + option + '" class="cs-text-box w-100" name="' + option + '_' + breakpoint + "\" onchange=\"updateOptions(this.getAttribute('data-type'),'" + breakpoint + '\',this.value)"><option value="both">Text &amp; Background</option><option value="text">Text</option><option value="background">Background</option></select></td>';
                break;
              default:
                default_val = '';
            }
          }
          html += '</tr>';
        }
        html += '<tr><td></td><td colspan="3"><button style="margin-top:20px;" class="apply-btn btn cs-btn-success btn-large w-100" onclick="applyOptions()">Apply</button></td></tr>';

        document.getElementById('opts').innerHTML = html;
        block_seq = $('#block_seq');
      }
      //clear form
      function clearForm() {
        $('#row_above.row .block,#row_below.row .block,#content .row').remove();

        data.above.row_above.blocks = {};
        data.content = {};
        data.below.row_below.blocks = {};
        data.output.settings.rowAnchor = {};

        for (var i = 0; i < data.loops.breakpoints.length; i++) {
          var size = data.loops.breakpoints[i];

          data.output.settings.margin[size].top = 80;
          data.output.settings.margin[size].bottom = 80;

          $('#' + size + '_top_margin').val(data.output.settings.margin[size].top);
          $('#' + size + '_bottom_margin').val(data.output.settings.margin[size].bottom);

          updateMargin(size, 'top', data.output.settings.margin[size].top);
          updateMargin(size, 'bottom', data.output.settings.margin[size].bottom);
        }
      }
      //apply templates
      function updateTemplates(elem) {
        if (elem) {
          var action = elem.getAttribute('data-action');
          var template = elem.value;

          if (template === '' && action === 'clear') {
            init();
          } else if (template !== '') {
            init(data.templates[template].template);
          }

          elem.dataset.action = 'clear';
        } else if (!processing) {
          updateFilters('filters');
          updateFilters('templates');
        }
      }
      //update filters
      function updateFilters(select) {
        var elem = document.getElementById(select);

        if (elem && elem.getElementsByTagName('option').length > 0) {
          elem.getElementsByTagName('option')[0].selected = 'selected';

          if (select === 'filters') {
            filterTemplates(elem);
          } else {
            elem.dataset.action = '';
          }
        }
      }
      //change breakpoint
      function updateBreakpoint(size) {
        for (var i = 0; i < data.loops.breakpoints.length; i++) {
          $(body).removeClass(data.loops.breakpoints[i]);
        }

        $(body).addClass(size);

        updateGridHeight();
        updateMargin(size, 'top', data.output.settings.margin[size].top);
        updateMargin(size, 'bottom', data.output.settings.margin[size].bottom);
      }
      //add row
      function addRow(row_id, pos, set) {
        var id = set || unique;
        var str = '<div id="row_' + id + '" class="row"><div class="ctrl-block"><div class="add" onclick="addBlock(\'content\',' + id + ')">&#43; &#9635;</div></div><div class="ctrl-row"><div class="add before" onclick="addRow(' + id + ',\'before\')">&#43; &#8593;</div><div class="remove" onclick="removeRow(' + id + ')">&#8592; &#215;</div><div class="add after" onclick="addRow(' + id + ",'after')\">&#43; &#8595;</div></div></div>";
        var elem;

        if (row_id === undefined) {
          $(content).append(str);
        } else {
          elem = $('#row_' + row_id);

          if (pos === 'before') {
            $(elem).before(str);
          } else {
            $(elem).after(str);
          }
        }

        updateRowData(id, 'add');
        unique++;
      }
      //remove row
      function removeRow(row_id) {
        $(data.content['row_' + row_id].elem).remove();

        updateRowData(row_id, 'remove');
      }
      //update row data
      function updateRowData(row_id, action) {
        updateTemplates();

        if (action === 'remove') {
          delete data.content['row_' + row_id];
        } else {
          data.content['row_' + row_id] = {
            elem: document.getElementById('row_' + row_id),
            blocks: {}
          };
        }

        updateRemoval();
        updateData();
      }
      //update content height
      function updateGridHeight() {
        clearTimeout(updateGridDelay);

        updateGridDelay = setTimeout(function () {
          $(grid).height($(overlay).height());

          updateCSHeight();
        }, 100);
      }
      //show/hide row removal btn
      function updateRemoval() {
        if ($('#content .row').length < 2) {
          $(content).addClass('hide-removal');
        } else {
          $(content).removeClass('hide-removal');
        }
      }
      //add block
      function addBlock(area, row_id, set, block) {
        var id = set || unique;
        var str = '<div id="block_' + id + '" class="block span-sm-1 offset-sm-0"><div class="remove" onclick="removeBlock(\'' + area + "','" + row_id + "'," + id + ')">&#215;</div><div class="opts" onclick="showOptions(\'' + area + "','" + row_id + "'," + id + ')">&#x2026;</div><div class="view"><div class="view-wrap"><div class="background"></div><div class="text">-</br>--</br>-</div></div></div><div class="num"></div></div>';

        $('#row_' + row_id).append(str);

        updateBlockData(area, row_id, id, 'add', block);
        unique++;
      }
      //remove block
      function removeBlock(area, row_id, block_id) {
        $(data[area]['row_' + row_id].blocks['block_' + block_id].elem).remove();

        updateBlockData(area, row_id, block_id, 'remove');
      }
      //update block data
      function updateBlockData(area, row_id, block_id, action, block) {
        updateTemplates();

        if (action === 'remove') {
          delete data[area]['row_' + row_id].blocks['block_' + block_id];
        } else {
          var breakpoint = '';
          var option = '';
          var obj = {};
          var val;
          var default_val;

          if (!data[area]['row_' + row_id]) {
            data[area]['row_' + row_id] = {
              blocks: {}
            };
          }

          obj.elem = document.getElementById('block_' + block_id);
          obj.options = {};

          for (var i = 0; i < data.loops.breakpoints.length; i++) {
            breakpoint = data.loops.breakpoints[i];
            obj.options[breakpoint] = {};

            for (var x = 0; x < data.loops.options.length; x++) {
              option = data.loops.options[x];
              val = '';
              default_val = '';

              if (breakpoint === 'sm') {
                switch (option) {
                  case 'hidden':
                    default_val = 'show';
                    break;
                  case 'offset':
                    default_val = 0;
                    break;
                  case 'span':
                    default_val = 1;
                    break;
                  case 'split':
                    default_val = 'none';
                    break;
                  case 'anchor':
                    default_val = 'center';
                    break;
                  case 'justify':
                    default_val = 'center';
                    break;
                  case 'padding':
                    default_val = '0 15px';
                    break;
                  case 'margin':
                    default_val = '0 15px';
                    break;
                  case 'border':
                    default_val = 'none';
                    break;
                  case 'animation':
                    default_val = 'none';
                    break;
                  case 'animate':
                    default_val = 'both';
                    break;
                  default:
                    default_val = '';
                }
              }
              val = block ? block[breakpoint][option] : default_val;
              obj.options[breakpoint][option] = val;
            }
          }
          data[area]['row_' + row_id].blocks['block_' + block_id] = obj;
        }

        updateData();
      }
      //show options
      function showOptions(area, row_id, block_id) {
        clearError();

        var breakpoint = '';
        var option = '';
        var blockObj = data[area]['row_' + row_id].blocks['block_' + block_id];
        var blockOptions = blockObj.options;

        data.options.area = area;
        data.options.row = row_id;
        data.options.block = block_id;

        for (var i = 0; i < data.loops.breakpoints.length; i++) {
          breakpoint = data.loops.breakpoints[i];
          for (var x = 0; x < data.loops.options.length; x++) {
            option = data.loops.options[x];
            data.options[breakpoint][option] = blockOptions[breakpoint][option];
            $('#' + [option] + '_' + [breakpoint]).val(data.options[breakpoint][option]);
          }
        }

        $(block_seq).text(blockObj.seq);

        $(options).toggleClass('show-opts');
      }
      //capture inputs in data obj
      function updateOptions(type, size, val) {
        data.options[size][type] = val;

        validate();
      }
      //validate
      function validate() {
        var error = false;
        var breakpoint = '';

        clearError();

        for (var y = 0; y < data.loops.breakpoints.length; y++) {
          breakpoint = data.loops.breakpoints[y];
          if (!testTotalColsBlock(breakpoint)) {
            error = true;
            $(options).addClass('offset-error-' + breakpoint);
            $(options).addClass('span-error-' + breakpoint);
          }

          if (!testAnimOpts(breakpoint)) {
            error = true;
            $(options).addClass('animation-error-' + breakpoint);
            $(options).addClass('animate-error-' + breakpoint);
          }
        }

        if (!testHiddenBreakpoints()) {
          error = true;
          $(options).addClass('hidden-error');
        }

        return error;
      }
      //clear error validation
      function clearError() {
        for (var x = 0; x < data.loops.options.length; x++) {
          for (var i = 0; i < data.loops.breakpoints.length; i++) {
            $(options).removeClass(data.loops.options[x] + '-error-' + data.loops.breakpoints[i]);
          }
        }

        $(options).removeClass('hidden-error');
      }
      //apply options
      function applyOptions() {
        if (!validate()) {
          updateTemplates();

          var blockOptions = data[data.options.area]['row_' + data.options.row].blocks['block_' + data.options.block].options;
          var breakpoint = '';
          var option = '';
          var val = '';

          for (var i = 0; i < data.loops.breakpoints.length; i++) {
            breakpoint = data.loops.breakpoints[i];
            for (var x = 0; x < data.loops.options.length; x++) {
              option = data.loops.options[x];
              val = data.options[breakpoint][option];

              if (!val && (option === 'padding' || option === 'margin') && breakpoint === 'sm') {
                val = '0';
              }

              blockOptions[breakpoint][option] = val;
            }
          }

          updateBlock(data.options.area, data.options.row, data.options.block);
          closeOptions();
          updateData();
        }
      }
      //update block
      function updateBlock(area, row_id, block_id) {
        var block = data[area]['row_' + row_id].blocks['block_' + block_id];
        var breakpoint = '';
        var option = '';
        var selection = '';
        var className = '';
        var regex;

        for (var i = 0; i < data.loops.breakpoints.length; i++) {
          breakpoint = data.loops.breakpoints[i];

          for (var x = 0; x < data.loops.options.length; x++) {
            option = data.loops.options[x];

            if (exclusions.indexOf(option) < 0) {
              selection = block.options[breakpoint][option] !== undefined ? block.options[breakpoint][option] : '';
              regex = new RegExp([option] + '-' + breakpoint + '-[\\w\\d]+', 'g');

              if (selection !== '') {
                className = option + '-' + breakpoint + '-' + selection;

                if (block.elem.className.match(regex)) {
                  block.elem.className = block.elem.className.replace(regex, className);
                } else {
                  block.elem.className = block.elem.className + ' ' + className;
                }
              }
            }
          }
        }
      }
      //close options
      function closeOptions() {
        $(options).toggleClass('show-opts');

        data.options.area = '';
        data.options.row = '';
        data.options.block = '';

        for (var i = 0; i < data.loops.breakpoints.length; i++) {
          for (var x = 0; x < data.loops.options.length; x++) {
            data.options[data.loops.breakpoints[i]][data.loops.options[x]] = '';
          }
        }
      }
      //get total columns used in block
      function testTotalColsBlock(size) {
        var ind = data.loops.breakpoints.indexOf(size);
        var offset = data.options[size].offset || data.options[data.loops.breakpoints[ind - 1] || size].offset || data.options[data.loops.breakpoints[ind - 2] || size].offset || 0;
        var span = data.options[size].span || data.options[data.loops.breakpoints[ind - 1] || size].span || data.options[data.loops.breakpoints[ind - 2] || size].span || 1;

        return offset + span <= 12 ? true : false;
      }
      //ensure both animation options are selected
      function testAnimOpts(size) {
        var animation = data.options[size].animation || false;
        var animate = data.options[size].animate || false;

        return (!animation || !animate) && !(!animation && !animate) && animation !== 'none' ? false : true;
      }
      //ensure one breakpoint is shown
      function testHiddenBreakpoints() {
        var valid = false;

        for (var i = 0; i < data.loops.breakpoints.length; i++) {
          if (data.options[data.loops.breakpoints[i]].hidden === 'show') {
            valid = true;
          }
        }

        return valid;
      }
      //update margin
      function updateMargin(size, pos, val) {
        var css = val * -1 + 'px';

        if (pos === 'bottom') {
          $('.' + size + ' .module-bottom').css('bottom', css);

          data.output.settings.margin[size].bottom = val;
        } else {
          $('.' + size + ' .module-top').css('top', css);

          data.output.settings.margin[size].top = val;
        }

        if (!processing) {
          storeData();
        }
      }
      //add class for margin
      function checkContent() {
        var above = data.above.row_above.blocks;
        var below = data.below.row_below.blocks;
        var top = false;
        var bottom = false;
        var size;
        var hidden;

        for (var i = 0; i < data.loops.breakpoints.length; i++) {
          size = data.loops.breakpoints[i];
          top = false;
          bottom = false;

          for (var aBlock in above) {
            hidden = above[aBlock].options[size].hidden || above[aBlock].options[data.loops.breakpoints[i - 1] || size].hidden || above[aBlock].options[data.loops.breakpoints[i - 2] || size].hidden;

            if (hidden === 'show') {
              top = true;
            }
          }

          if (top) {
            $(preview).addClass(size + '-has-top-content');
          } else {
            $(preview).removeClass(size + '-has-top-content');
          }

          for (var bBlock in below) {
            hidden = below[bBlock].options[size].hidden || below[bBlock].options[data.loops.breakpoints[i - 1] || size].hidden || below[bBlock].options[data.loops.breakpoints[i - 2] || size].hidden;

            if (hidden === 'show') {
              bottom = true;
            }
          }

          if (bottom) {
            $(preview).addClass(size + '-has-bottom-content');
          } else {
            $(preview).removeClass(size + '-has-bottom-content');
          }
        }
      }
      //update ouput data
      function updateData() {
        updateGridHeight();

        if (!processing) {
          checkContent();

          var breakpoint = '';
          var option = '';
          var area = '';
          var rowElems = '';
          var rows = [];
          var row_id = '';
          var blockElems = '';
          var blocks = [];
          var block_id = '';
          var blockObj = {};
          var optsObj = {};
          var iter = 1;

          data.output.layout = {};

          for (var i = 0; i < data.loops.areas.length; i++) {
            area = data.loops.areas[i];
            data.output.layout[area] = [];
            rows = [];
            rowElems = $('#' + (area !== 'content' ? 'row_' + area + '.row' : area + ' .row'));

            for (var x = 0; x < rowElems.length; x++) {
              blocks = [];
              blockElems = $(rowElems[x]).find('.block');

              for (var y = 0; y < blockElems.length; y++) {
                blockObj = {};
                optsObj = {};

                row_id = $(rowElems[x]).attr('id');
                block_id = $(blockElems[y]).attr('id');

                blockObj = data[area][row_id].blocks[block_id];
                blockObj.seq = iter;
                $(blockObj.elem)
                  .find('.num')
                  .text(iter++);

                for (var z = 0; z < data.loops.breakpoints.length; z++) {
                  breakpoint = data.loops.breakpoints[z];
                  optsObj[breakpoint] = {};

                  for (var j = 0; j < data.loops.options.length; j++) {
                    option = data.loops.options[j];
                    val = blockObj.options[breakpoint][option];

                    if (val !== '') {
                      optsObj[breakpoint][option] = val;
                    }
                  }
                }
                blocks.push(optsObj);
              }
              rows.push(blocks);
            }
            data.output.layout[area] = rows;
          }
          storeData();
          updateCSHeight();
        }
      }
      //update CS height
      function updateCSHeight() {
        clearTimeout(updateCSDelay);

        updateCSDelay = setTimeout(function () {
          //extensionField.window.updateHeight(document.getElementById('height').offsetHeight);
        }, 100);
      }
      //save data to CS
      function storeData() {
        clearTimeout(updateCSDataDelay);

        updateCSDataDelay = setTimeout(function () {
          console.log('Master Module Extension Data', data.output);
          localStorage.setItem("module",JSON.stringify(data.output));
          //extensionField.field.setData(data.output);
        }, 500);
      }

      //load saved template entries
      function getTemplates() {
        var env = extensionField.stack._data.name || 'PROD';
        var xhr = new XMLHttpRequest();

        xhr.open('GET', extensionField.config.baseURL + 'v3/content_types/' + extensionField.config.contentType + '/entries?environment=' + extensionField.config.templateEnv, true);
        xhr.setRequestHeader('api_key', extensionField.config[env].apiKey);
        xhr.setRequestHeader('access_token', extensionField.config[env].deliveryToken);
        xhr.onreadystatechange = function () {
          if (xhr.readyState === XMLHttpRequest.DONE) {
            var status = xhr.status;
            if (status === 0 || (status >= 200 && status < 400)) {
              if (this.response) {
                createTemplates(JSON.parse(this.response).entries);
              } else {
                return false;
              }
            } else {
              return false;
            }
          }
        };
        xhr.send();
      }

      // ContentstackUIExtension.init().then(function (extension) {
      //   extensionField = extension;
      //   extension.window.updateHeight(800);

      //   if (extensionField.field.schema.config.showTemplates) {
      //     getTemplates();
      //   }

      //   init(extensionField.field.getData());
      // });
      var template_examples = [
        {
          "title": "Landing Page - Hero",
          "template": {
            "settings": {
              "rowAnchor": "default",
              "margin": {
                "sm": {
                  "top": 80,
                  "bottom": 80
                },
                "md": {
                  "top": 80,
                  "bottom": 80
                },
                "lg": {
                  "top": 80,
                  "bottom": 80
                }
              }
            },
            "layout": {
              "above": [
                []
              ],
              "content": [
                [
                  {
                    "sm": {
                      "hidden": "show",
                      "offset": 0,
                      "span": 12,
                      "split": "none",
                      "anchor": "center",
                      "justify": "center",
                      "padding": "0 15px",
                      "margin": "0 15px",
                      "border": "none",
                      "animation": "none",
                      "animate": "both"
                    },
                    "md": {},
                    "lg": {}
                  }
                ]
              ],
              "below": [
                []
              ]
            }
          }
        },
        {
          "title": "Landing Page - Even Thirds",
          "template": {
            "settings": {
              "rowAnchor": "default",
              "margin": {
                "sm": {
                  "top": 80,
                  "bottom": 80
                },
                "md": {
                  "top": 80,
                  "bottom": 80
                },
                "lg": {
                  "top": 80,
                  "bottom": 80
                }
              }
            },
            "layout": {
              "above": [
                []
              ],
              "content": [
                [
                  {
                    "sm": {
                      "hidden": "show",
                      "offset": 0,
                      "span": 12,
                      "split": "none",
                      "anchor": "center",
                      "justify": "center",
                      "padding": "0 15px",
                      "margin": "0 15px",
                      "border": "none",
                      "animation": "none",
                      "animate": "both"
                    },
                    "md": {
                      "span": 4
                    },
                    "lg": {}
                  },
                  {
                    "sm": {
                      "hidden": "show",
                      "offset": 0,
                      "span": 12,
                      "split": "none",
                      "anchor": "center",
                      "justify": "center",
                      "padding": "0 15px",
                      "margin": "0 15px",
                      "border": "none",
                      "animation": "none",
                      "animate": "both"
                    },
                    "md": {
                      "span": 4
                    },
                    "lg": {}
                  },
                  {
                    "sm": {
                      "hidden": "show",
                      "offset": 0,
                      "span": 12,
                      "split": "none",
                      "anchor": "center",
                      "justify": "center",
                      "padding": "0 15px",
                      "margin": "0 15px",
                      "border": "none",
                      "animation": "none",
                      "animate": "both"
                    },
                    "md": {
                      "span": 4
                    },
                    "lg": {}
                  }
                ]
              ],
              "below": [
                []
              ]
            }
          }
        },
        {
          "title": "Navigation - 6 Across",
          "template": {
            "settings": {
              "rowAnchor": "default",
              "margin": {
                "sm": {
                  "top": 80,
                  "bottom": 80
                },
                "md": {
                  "top": 80,
                  "bottom": 80
                },
                "lg": {
                  "top": 80,
                  "bottom": 80
                }
              }
            },
            "layout": {
              "above": [
                []
              ],
              "content": [
                [
                  {
                    "sm": {
                      "hidden": "show",
                      "offset": 0,
                      "span": 6,
                      "split": "none",
                      "anchor": "center",
                      "justify": "center",
                      "padding": "0 15px",
                      "margin": "0 15px",
                      "border": "none",
                      "animation": "none",
                      "animate": "both"
                    },
                    "md": {
                      "span": 4
                    },
                    "lg": {
                      "span": 2
                    }
                  },
                  {
                    "sm": {
                      "hidden": "show",
                      "offset": 0,
                      "span": 6,
                      "split": "none",
                      "anchor": "center",
                      "justify": "center",
                      "padding": "0 15px",
                      "margin": "0 15px",
                      "border": "none",
                      "animation": "none",
                      "animate": "both"
                    },
                    "md": {
                      "span": 4
                    },
                    "lg": {
                      "span": 2
                    }
                  },
                  {
                    "sm": {
                      "hidden": "show",
                      "offset": 0,
                      "span": 6,
                      "split": "none",
                      "anchor": "center",
                      "justify": "center",
                      "padding": "0 15px",
                      "margin": "0 15px",
                      "border": "none",
                      "animation": "none",
                      "animate": "both"
                    },
                    "md": {
                      "span": 4
                    },
                    "lg": {
                      "span": 2
                    }
                  },
                  {
                    "sm": {
                      "hidden": "show",
                      "offset": 0,
                      "span": 6,
                      "split": "none",
                      "anchor": "center",
                      "justify": "center",
                      "padding": "0 15px",
                      "margin": "0 15px",
                      "border": "none",
                      "animation": "none",
                      "animate": "both"
                    },
                    "md": {
                      "span": 4
                    },
                    "lg": {
                      "span": 2
                    }
                  },
                  {
                    "sm": {
                      "hidden": "show",
                      "offset": 0,
                      "span": 6,
                      "split": "none",
                      "anchor": "center",
                      "justify": "center",
                      "padding": "0 15px",
                      "margin": "0 15px",
                      "border": "none",
                      "animation": "none",
                      "animate": "both"
                    },
                    "md": {
                      "span": 4
                    },
                    "lg": {
                      "span": 2
                    }
                  },
                  {
                    "sm": {
                      "hidden": "show",
                      "offset": 0,
                      "span": 6,
                      "split": "none",
                      "anchor": "center",
                      "justify": "center",
                      "padding": "0 15px",
                      "margin": "0 15px",
                      "border": "none",
                      "animation": "none",
                      "animate": "both"
                    },
                    "md": {
                      "span": 4
                    },
                    "lg": {
                      "span": 2
                    }
                  }
                ]
              ],
              "below": [
                []
              ]
            }
          }
        }
      ];

      createTemplates(template_examples);

      init(JSON.parse(localStorage.getItem("module")));
    </script>
  </body>
</html>